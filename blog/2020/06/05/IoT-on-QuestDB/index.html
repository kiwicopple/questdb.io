<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>IoT on QuestDB · QuestDB</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="As you can well imagine, I&#x27;ve been super busy in my hew job at QuestDB so this has taken me longer than I would have liked, but here we are. If you know me at all, you know that one of the first things I always do with new things is, well, connect things to them! So I immediately went to connect an IoT device to QuestDB to see how it went. Unsurprisingly, it went quite well. So here&#x27;s how it went, from start to finish."/><meta name="docsearch:language" content="en"/><meta property="og:title" content="IoT on QuestDB · QuestDB"/><meta property="og:type" content="website"/><meta property="og:url" content="https://questdb.io/blog/2020/06/05/IoT-on-QuestDB"/><meta property="og:description" content="As you can well imagine, I&#x27;ve been super busy in my hew job at QuestDB so this has taken me longer than I would have liked, but here we are. If you know me at all, you know that one of the first things I always do with new things is, well, connect things to them! So I immediately went to connect an IoT device to QuestDB to see how it went. Unsurprisingly, it went quite well. So here&#x27;s how it went, from start to finish."/><meta property="og:image" content="https://questdb.io/img/questdb_og.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://questdb.io/img/questdb_og.png"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="alternate" type="application/atom+xml" href="https://questdb.io/blog/atom.xml" title="QuestDB Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://questdb.io/blog/feed.xml" title="QuestDB Blog RSS Feed"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=GTM-PVR7M2G"></script><script>
              window.dataLayer = window.dataLayer || [];
              function gtag(){dataLayer.push(arguments); }
              gtag('js', new Date());
              gtag('config', 'GTM-PVR7M2G');
            </script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,700|IBM+Plex+Sans:300,400,600,700"/><script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js"></script><script type="text/javascript" src="/js/fonts.js"></script><script type="text/javascript" src="/js/menu-hack.js"></script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/code-block-buttons.js"></script><script type="text/javascript" src="/js/getstarted.js"></script><script type="text/javascript" src="/js/hotjar.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/QuestDB_Logo.png" alt="QuestDB"/><h2 class="headerTitleWithLogo">QuestDB</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/getstarted" target="_self">Get QuestDB</a></li><li class=""><a href="/docs/documentationOverview" target="_self">Documentation</a></li><li class="siteNavGroupActive"><a href="/blog/" target="_self">Blog</a></li><li class=""><a href="/careers" target="_self">Careers</a></li><li class=""><a href="https://serieux-saucisson-79115.herokuapp.com/" target="_self">Join</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search..." title="Search..."/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Recent Posts</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Recent Posts</h3><ul class=""><li class="navListItem navListItemActive"><a class="navItem" href="/blog/2020/06/05/IoT-on-QuestDB">IoT on QuestDB</a></li><li class="navListItem"><a class="navItem" href="/blog/2020/05/12/interesting-things-we-learned-about-sums">Things we learned about sums</a></li><li class="navListItem"><a class="navItem" href="/blog/2020/04/02/using-simd-to-aggregate-billions-of-rows-per-second">Using SIMD to aggregate billions of rows per second</a></li><li class="navListItem"><a class="navItem" href="/blog/2020/03/15/interthread">The art of thread messaging</a></li><li class="navListItem"><a class="navItem" href="/blog/2019/12/19/lineprot">What makes QuestDB faster than InfluxDB</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer postContainer blogContainer"><div class="wrapper"><div class="lonePost"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle"><a href="/blog/2020/06/05/IoT-on-QuestDB">IoT on QuestDB</a></h1><p class="post-meta">June 5, 2020</p><div class="authorBlock"><p class="post-authorName"><a target="_blank" rel="noreferrer noopener">David G Simmons</a></p></div></header><div><span><p>As you can well imagine, I've been super busy in my hew job at QuestDB so this has taken me longer than I would have liked, but here we are. If you know me at all, you know that one of the first things I always do with new things is, well, connect things to them! So I immediately went to connect an IoT device to QuestDB to see how it went. Unsurprisingly, it went quite well. So here's how it went, from start to finish.</p>
<p>If you like what you see here, pleases go give us a star on <a href="https://github.com/questdb">GitHub</a></p>
<h2><a class="anchor" aria-hidden="true" id="the-database-part"></a><a href="#the-database-part" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The Database Part</h2>
<p>The first thing I had to do was a to get QuestDB up and running. Luckily, this is very straightforward. I guess I could have gone the Docker route, but as you're probably aware, I'm not a huge fan of Docker (in no small part due to the fact that it will literally suck the life out of a MacOS laptop). There's also (for you MacOS users) <code>brew install questdb</code> but since I work here, and I wanted to test out the latest and greatest web console, I decided to build from source:</p>
<p><a href="https://davidgs.com/wp-content/uploads/2020/06/Build.gif"><img src="https://davidgs.com/wp-content/uploads/2020/06/Build.gif" alt="" /></a></p>
<p>It builds really quickly due to the lack of external dependencies, so that is great! Then all I have to do is start it:</p>
<p><a href="https://davidgs.com/wp-content/uploads/2020/06/StartQuest.gif"><img class="wp-image-829" src="https://davidgs.com/wp-content/uploads/2020/06/StartQuest.gif" alt="" /></a></p>
<p>That is literally all there is to getting QuestDB built and running. But that's just the first part. Now it's time to do something mildly useful with it. First, I'll need to create a table in QuestDB to store my IoT Data (A bit more on this later, so store a pointer to this).</p>
<p><img title="Screen Shot 2020-06-04 at 9.15.33 AM.png" src="https://davidgs.com/wp-content/uploads/2020/06/Screen-Shot-2020-06-04-at-9.15.33-AM-1.png" alt="Screen Shot 2020 06 04 at 9 15 33 AM" /></p>
<p>Remember, we're doing SQL here, so it there's no new language or syntax to learn. This is a really simple table that I'm building because I'm going to be using an ESP8266 with a (really awful) DHT11 temperature and humidity sensor on it.</p>
<h2><a class="anchor" aria-hidden="true" id="the-sensor-part"></a><a href="#the-sensor-part" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The Sensor Part</h2>
<p>For this I'm going to use an ESP8266-based WEMOS D1 Mini only because I happen to have a giant pile of them lying around. I buy them in bulk because they are a dollar or 2 each, easy to use, and largely disposable if I blow one up (which I do with alarming regularity.). The circuit is extremely simple to do:</p>
<p><img title="Screen Shot 2020-06-04 at 9.24.39 AM.png" src="https://davidgs.com/wp-content/uploads/2020/06/Screen-Shot-2020-06-04-at-9.24.39-AM-1.png" alt="Screen Shot 2020 06 04 at 9 24 39 AM" /></p>
<p>I used an actual WEMOS Shield with the DHT11 on it, so I didn't have to breadboard it, but this schematic gives you an idea of how simple the wiring is. It's literally 3 wires.</p></p>
<h2><a class="anchor" aria-hidden="true" id="the-code-part"></a><a href="#the-code-part" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The Code Part</h2>
<p>Here is where the magic happens. How I actually send the sensor data to the database. There is a simple example program included with the Adafruit DHT Unified Sensor Library that I recommend starting with in order to make this a bit easier. It already has all the parts to read from the sensor so you don't have to write those from scratch. Remember: Good developers copy, but great developers paste!</p></p>
<p>Since I'm using the 8266, and I'll need internet connectivity, I'll need all the WiFi bits:</p>
<pre><code class="hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;WiFiServerSecure.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;WiFiClientSecure.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;WiFiClientSecureBearSSL.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;ESP8266WiFi.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;ESP8266WiFiMulti.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;WiFiUdp.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;ESP8266WiFiType.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;CertStoreBearSSL.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;ESP8266WiFiAP.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;WiFiClient.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;BearSSLHelpers.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;WiFiServer.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;ESP8266WiFiScan.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;WiFiServerSecureBearSSL.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;ESP8266WiFiGeneric.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;ESP8266WiFiSTA.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;WiFiClientSecureAxTLS.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;WiFiServerSecureAxTLS.h&gt;</span></span>
</code></pre>
<p>Really all you have to do is go to the 'Sketch' Menu, Choose 'Include Library' and select the 'ESP8266WiFi' library and you get all this stuff imported for you.</p>
<p>Here's some boiler-plate code you can always use to get your ESP8266 on your WiFi:</p>
<pre><code class="hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;Adafruit_Sensor.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;DHT.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;DHT_U.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DHTPIN D4</span>

<span class="hljs-comment">// Digital pin connected to the DHT sensor</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DHTTYPE DHT11 <span class="hljs-comment">// DHT 11</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> QUEST_SERVER <span class="hljs-meta-string">"10.10.10.10"</span> <span class="hljs-comment">// use your server's IP address!</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> QUEST_PORT 9009</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SENSOR_ID 4343 <span class="hljs-comment">// I made this up</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SENSOR_NAME <span class="hljs-meta-string">"DHT11-WEMOS"</span></span>

<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* ssid = <span class="hljs-string">"your-ssid"</span>;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* password = <span class="hljs-string">"your-password"</span>;
<span class="hljs-function">DHT_Unified <span class="hljs-title">dht</span><span class="hljs-params">(DHTPIN, DHTTYPE)</span></span>;
<span class="hljs-keyword">uint32_t</span> delayMS;
<span class="hljs-built_in">WiFiUDP</span> Udp;

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span></span>{
  <span class="hljs-built_in">Serial</span>.<span class="hljs-built_in">begin</span>(<span class="hljs-number">115200</span>);
  <span class="hljs-built_in">delay</span>(<span class="hljs-number">10</span>);
  <span class="hljs-comment">// We start by connecting to a WiFi network</span>
  <span class="hljs-built_in">Serial</span>.<span class="hljs-built_in">print</span>(<span class="hljs-string">"Connecting to "</span>);
  <span class="hljs-built_in">Serial</span>.<span class="hljs-built_in">println</span>(ssid);
  <span class="hljs-built_in">WiFi</span>.<span class="hljs-built_in">begin</span>(ssid, password);
  <span class="hljs-keyword">while</span> (<span class="hljs-built_in">WiFi</span>.status() != WL_CONNECTED) {
    <span class="hljs-built_in">delay</span>(<span class="hljs-number">500</span>);
    <span class="hljs-built_in">Serial</span>.<span class="hljs-built_in">print</span>(<span class="hljs-string">"."</span>);
  }
  <span class="hljs-built_in">Serial</span>.<span class="hljs-built_in">println</span>(<span class="hljs-string">""</span>);
  <span class="hljs-built_in">Serial</span>.<span class="hljs-built_in">println</span>(<span class="hljs-string">"WiFi connected"</span>);
  <span class="hljs-built_in">Serial</span>.<span class="hljs-built_in">println</span>(<span class="hljs-string">"IP address: "</span>);
  <span class="hljs-built_in">Serial</span>.<span class="hljs-built_in">println</span>(<span class="hljs-built_in">WiFi</span>.<span class="hljs-built_in">localIP</span>());
  dht.<span class="hljs-built_in">begin</span>();
  Udp.<span class="hljs-built_in">begin</span>(QUEST_PORT);
  <span class="hljs-built_in">Serial</span>.<span class="hljs-built_in">println</span>(F(<span class="hljs-string">"DHTxx Unified Sensor Example"</span>));
  <span class="hljs-comment">// Print temperature sensor details.</span>
  <span class="hljs-keyword">sensor_t</span> sensor;
  dht.temperature().getSensor(&amp;sensor);
  <span class="hljs-built_in">Serial</span>.<span class="hljs-built_in">println</span>(F(<span class="hljs-string">"------------------------------------"</span>));
  <span class="hljs-built_in">Serial</span>.<span class="hljs-built_in">println</span>(F(<span class="hljs-string">"Temperature Sensor"</span>));
  <span class="hljs-built_in">Serial</span>.<span class="hljs-built_in">print</span> (F(<span class="hljs-string">"Sensor Type: "</span>));
  <span class="hljs-built_in">Serial</span>.<span class="hljs-built_in">println</span>(sensor.name);
  <span class="hljs-built_in">Serial</span>.<span class="hljs-built_in">print</span> (F(<span class="hljs-string">"Driver Ver: "</span>));
  <span class="hljs-built_in">Serial</span>.<span class="hljs-built_in">println</span>(sensor.version);
  <span class="hljs-built_in">Serial</span>.<span class="hljs-built_in">print</span> (F(<span class="hljs-string">"Unique ID: "</span>));
  <span class="hljs-built_in">Serial</span>.<span class="hljs-built_in">println</span>(sensor.sensor_id);
  <span class="hljs-built_in">Serial</span>.<span class="hljs-built_in">print</span> (F(<span class="hljs-string">"Max Value: "</span>));
  <span class="hljs-built_in">Serial</span>.<span class="hljs-built_in">print</span>(sensor.max_value);
  <span class="hljs-built_in">Serial</span>.<span class="hljs-built_in">println</span>(F(<span class="hljs-string">"°C"</span>));
  <span class="hljs-built_in">Serial</span>.<span class="hljs-built_in">print</span> (F(<span class="hljs-string">"Min Value: "</span>));
  <span class="hljs-built_in">Serial</span>.<span class="hljs-built_in">print</span>(sensor.min_value);
  <span class="hljs-built_in">Serial</span>.<span class="hljs-built_in">println</span>(F(<span class="hljs-string">"°C"</span>));
  <span class="hljs-built_in">Serial</span>.<span class="hljs-built_in">print</span> (F(<span class="hljs-string">"Resolution: "</span>));
}
</code></pre>
<p>That gets the basics set up. Running that should get you a WiFi connection and a fully configured DHT11 sensor. We're almost ready to start sending data to the database</p>
<p>If you were paying attention, and read the code, you'll have noticed the UDP stuff I snuck in there. That's because we're going to make this super easy and use UDP to send our data. And there's a <strong>really</strong> good reason for that: InfluxDB Line Protocol. You see, QuestDB has a built-in InfluxDB Line Protocol listener, but (for now) it's only listening on a UDP port. So we're going to use that.</p>
<p>Now, to send some data:</p>
<pre><code class="hljs">void loop<span class="hljs-literal">()</span> {
  <span class="hljs-comment">// Delay between measurements.</span>
  delay(delayMS);
  <span class="hljs-built_in">char</span> *buffer;
  buffer = (<span class="hljs-built_in">char</span> *)malloc(<span class="hljs-number">256</span>);
  <span class="hljs-comment">// Get temperature event and print its value.</span>
  double temp = -<span class="hljs-number">212</span>;
  double hum = -<span class="hljs-number">1</span>;
  sensors_event_t event;
  dht.temperature<span class="hljs-literal">()</span>.get<span class="hljs-constructor">Event(&amp;<span class="hljs-params">event</span>)</span>;
  <span class="hljs-keyword">if</span> (isnan(event.temperature)) {
    <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Serial</span>.</span></span>println(<span class="hljs-constructor">F(<span class="hljs-string">"Error reading temperature!"</span>)</span>);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Serial</span>.</span></span>print(<span class="hljs-constructor">F(<span class="hljs-string">"Temperature: "</span>)</span>);
    <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Serial</span>.</span></span>print(event.temperature);
    temp = event.temperature;
    <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Serial</span>.</span></span>println(<span class="hljs-constructor">F(<span class="hljs-string">"°C"</span>)</span>);
  }
  <span class="hljs-comment">// Get humidity event and print its value.</span>
  dht.humidity<span class="hljs-literal">()</span>.get<span class="hljs-constructor">Event(&amp;<span class="hljs-params">event</span>)</span>;
  <span class="hljs-keyword">if</span> (isnan(event.relative_humidity)) {
    <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Serial</span>.</span></span>println(<span class="hljs-constructor">F(<span class="hljs-string">"Error reading humidity!"</span>)</span>);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Serial</span>.</span></span>print(<span class="hljs-constructor">F(<span class="hljs-string">"Humidity: "</span>)</span>);
    <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Serial</span>.</span></span>print(event.relative_humidity);
    hum = event.relative_humidity;
    <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Serial</span>.</span></span>println(<span class="hljs-constructor">F(<span class="hljs-string">"%"</span>)</span>);
  }
  <span class="hljs-keyword">if</span>(temp != -<span class="hljs-number">212</span><span class="hljs-operator"> &amp;&amp; </span>hum != -<span class="hljs-number">1</span>){
    <span class="hljs-built_in">char</span> tTemp<span class="hljs-literal">[<span class="hljs-number">10</span>]</span>;
    <span class="hljs-built_in">char</span> hTemp<span class="hljs-literal">[<span class="hljs-number">10</span>]</span>;
    dtostrf(temp, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>, tTemp);
    dtostrf(hum, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>, hTemp);
    sprintf(buffer, <span class="hljs-string">"iot,dev_id=%d,dev_name=%s temp_c=%s,humidity=%s"</span>, SENSOR_ID, SENSOR_NAME, tTemp, hTemp);
    <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Serial</span>.</span></span>println(buffer);
    <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Udp</span>.</span></span><span class="hljs-keyword">begin</span><span class="hljs-constructor">Packet(QUEST_SERVER, QUEST_PORT)</span>;
    <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Udp</span>.</span></span>write(buffer);
    <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Udp</span>.</span></span><span class="hljs-keyword">end</span><span class="hljs-constructor">Packet()</span>;
  }
  free(buffer);
}
</code></pre>
<p>Yeah, there's a lot going on in there. So let's break it down. First, I'm creating a buffer to hold the data I'm going to send, and then I'll do a read of the sensor. I set the <code>temp</code> and <code>hum</code> variables to values that I know the sensor will never return so that I can check that I got valid readings later, to avoid sending gibberish to the database.</p>
<p>I have to do some shenanigans with the temperature and humidity values in there because one of the shortcomings of Arduinos is that they don't have <code>sprintf</code> support for doubles. I know. So I simply turn them into strings and move on. Once they arrive at the database, they are interpreted as doubles and life is good. Not worth fighting about. I can then construct a buffer with straight line protocol and ship it off to QuestDB over UDP.</p>
<p>Don't forget to free the memory!</p>
<h2><a class="anchor" aria-hidden="true" id="that-pointer"></a><a href="#that-pointer" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>That Pointer</h2>
<p>Remember I told you to set a pointer earlier about creating the database? Well, here's where I come back to that. You don't <em>actually</em> have to create the database ahead of time <em>unless</em> you want to do things like set indexes, etc. If all you want to do is have straight values in there, then guess what? Schema-on-write is a thing here. You can just start writing data to the database, and it will happily store them for you. Pretty cool stuff.</p></p>
<h2><a class="anchor" aria-hidden="true" id="querying-the-data"></a><a href="#querying-the-data" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Querying the Data</h2>
<p>Using the QuestDB Console, you can then query the data to make sure you're getting what you expect:</p>
<p><a href="https://davidgs.com/wp-content/uploads/2020/06/queries.gif"><img class="wp-image-830" src="https://davidgs.com/wp-content/uploads/2020/06/queries.gif" alt="" /></a></p>
<p>That's exactly what I expected!</p>
<h2><a class="anchor" aria-hidden="true" id="whats-next"></a><a href="#whats-next" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>What's Next</h2>
<p>Now it's time to start building some dashboards, etc. on top of this. I'm currently working on connecting this all up with Node Red, so that may be my next post. We're also working on support for Grafana, which will be huge, so stay tuned for that. You can find us on <a href="https://github.com/questdb">GitHub</a> - follow the project if you'd like to get updates!</p></p>
</span></div></div><div class="blogSocialSection"></div></div><div class="blog-recent"><a class="button" href="/blog/">Recent Posts</a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#the-database-part">The Database Part</a></li><li><a href="#the-sensor-part">The Sensor Part</a></li><li><a href="#the-code-part">The Code Part</a></li><li><a href="#that-pointer">That Pointer</a></li><li><a href="#querying-the-data">Querying the Data</a></li><li><a href="#whats-next">What's Next</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><div align="left" class="footersection"><h5>QuestDB</h5><a href="/docs/documentationOverview">Documentation</a><a href="/getstarted">Download</a><a href="https://github.com/questdb/questdb/projects/3">Roadmap</a></div><div align="left" class="footersection"><h5>Community</h5><a href="https://join.slack.com/t/questdb/shared_invite/enQtNzk4Nzg4Mjc2MTE2LTEzZThjMzliMjUzMTBmYzVjYWNmM2UyNWJmNDdkMDYyZmE0ZDliZTQxN2EzNzk5MDE3Zjc1ZmJiZmFiZTIwMGY&gt;"> Join Slack </a><a href="https://twitter.com/intent/follow?screen_name=QuestDB" target="@QuestDB" rel="noreferrer noopener">Twitter</a></div><div align="left" class="footersection"><h5>More</h5><a href="/blog">Blog</a><a href="https://github.com/questdb/questdb">GitHub</a><span class="sucker"><a class="github-button" href="https://github.com/questdb/questdb" data-icon="octicon-star" data-count-href="/questdb/questdb/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></span><span class="github-trigger"><a class="github-button" href="https://github.com/questdb/questdb" data-icon="octicon-star" data-count-href="/questdb/questdb/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></span></div></section><section class="copyright">Copyright © 2020 QuestDB</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
              !function(f,b,e,v,n,t,s)
              {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
              n.callMethod.apply(n,arguments):n.queue.push(arguments)};
              if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
              n.queue=[];t=b.createElement(e);t.async=!0;
              t.src=v;s=b.getElementsByTagName(e)[0];
              s.parentNode.insertBefore(t,s)}(window, document,'script',
              'https://connect.facebook.net/en_US/fbevents.js');
              fbq('init', '648273155994655');
              fbq('track', 'PageView');
                </script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: 'b2a69b4869a2a85284a82fb57519dcda',
                indexName: 'questdb',
                inputSelector: '#search_input_react',
                algoliaOptions: {}
              });
            </script></body></html>